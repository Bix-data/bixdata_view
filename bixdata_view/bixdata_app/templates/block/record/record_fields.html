<div class="container">
{% for field_key,field in record_fields.items %}
{% with fieldname='tables['|add:field.tableid|add:'][insert][t_0][fields]['|add:field.fieldid|add:'][f_0]' %}
{% with fieldid='tables-'|add:field.tableid|add:'-insert-t_0-fields-'|add:field.fieldid|add:'f_0' %}
    <div class="row" id="fields_container">
        <div class="col-lg-2" style="text-align: left">
            <p>{{field.description }}</p>
        </div>
        <div class="col">
            {% if field.fieldtypeid == 'Parola' %}
                {% if field.lookuptableid  %}
            <div class="input-group mb-3">
              <select id="{{ fieldid }}" name="{{ fieldname }}" class="form-select">
                <option value="1">{{ field.value }}</option>
              </select>
            </div>
            {% else %}
               <label>
                    <input id="{{ fieldid }}" name="{{ fieldname }}" class="form-control" type="text" value="{{ field.value }}">
                </label>
            {% endif %}
        {% endif %}
            {% if field.fieldtypeid == 'Data' %}
                <label>
                    <input id="{{ fieldid }}" name="{{ fieldname }}" class="form-control" type="date" value="{{ field.value }}">
                </label>
            {% endif %}
            {% if field.fieldtypeid == 'Seriale' %}
            <p>{{ field.value}}</p>
            {% endif %}
            {% if field.fieldtypeid == 'Numero' %}
                <label>
                    <input id="{{ fieldid }}" name="{{ fieldname }}" class="form-control" type="number" value="{{ field.value }}">
                </label>
            {% endif %}
            {% if field.fieldtypeid == 'Memo' %}
                <textarea class="form-control" id="{{ fieldid }}" name="{{ fieldname }}" rows="3">{{ field.value }}</textarea>
            {% endif %}
            {% if field.fieldtypeid == 'Ora' %}
                <label>
                    <input id="{{ fieldid }}" name="{{ fieldname }}" class="form-control" type="time" value="{{ field.value }}">
                </label>
            {% endif %}
            {% if field.fieldtypeid == 'Utente' %}
            <div class="input-group mb-3">
              <select id="{{ fieldid }}" name="{{ fieldname }}" class="form-select">
                <option value="1">{{ field.value }}</option>
                <option value="2">Option 2</option>
              </select>
            </div>
            {% endif %}

        </div>
    </div>
    {% endwith %}
    {% endwith %}
{% endfor %}
            <button id="save-button" type="button" class="btn btn-primary" onclick="save_record()">Salva</button>
</div>

{% if function == "view" %}
  <script>
    $(document).ready(function(){
      $("input").attr("disabled", true);
      $("select").attr("disabled", true);
      $("textarea").attr("disabled", true);
      document.getElementById("save-button").style.display = "none";
    });
  </script>
{% else %}
  <script>
    $(document).ready(function(){
      $("input").attr("disabled", false);
      $("select").attr("disabled", false);
      $("textarea").attr("disabled", false);
    });
  </script>
{% endif %}


<style>
input:disabled, select:disabled, textarea:disabled {
  opacity: 1;
  cursor: default;
  background-color: #fff !important;
  color: #000;
}

</style>

<script>
function save_record() {

    var serialized_data = [];
    var serialized_data = $('#fields_container').find("select,textarea,input").serializeArray();
    serialized_data.push({name: 'funzione',value: 'test'});

    $.ajax({
        type: "POST",
        url: "{% url 'save_record_fields' %}",
        data: serialized_data,
        success: function(response) {
            alert('ok')
        },
        error: function() {
            alert('ko')
        }
    });

}

</script>







